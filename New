html_output = f"""
<html>
<head>
    <title>Closure Code Dashboard</title>
    <script>
    function switchMainTab(evt, tabName) {{
        const tabs = document.getElementsByClassName('main-tab');
        for (let i = 0; i < tabs.length; i++) {{
            tabs[i].style.display = 'none';
        }}
        const buttons = document.getElementsByClassName('maintablink');
        for (let i = 0; i < buttons.length; i++) {{
            buttons[i].classList.remove('active');
        }}
        document.getElementById(tabName).style.display = 'block';
        evt.currentTarget.classList.add('active');
    }}
    function openTab(evt, tabName) {{
        const tabs = document.getElementsByClassName("tabcontent");
        for (let i = 0; i < tabs.length; i++) {{
            tabs[i].style.display = "none";
        }}
        const links = document.getElementsByClassName("tablink");
        for (let i = 0; i < links.length; i++) {{
            links[i].classList.remove("active");
        }}
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
        setTimeout(() => {{ window.dispatchEvent(new Event('resize')); }}, 200);
    }}
    </script>
    <style>
        body {{
            font-family: sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }}
        .tablink, .maintablink {{
            background-color: #ddd;
            border: none;
            cursor: pointer;
            padding: 10px 20px;
            margin: 2px;
            font-size: 16px;
        }}
        .tablink.active, .maintablink.active {{
            background-color: #bbb;
        }}
        .tabcontent {{
            display: none;
            max-width: 1400px;
            width: 100%;
            background: white;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }}
        .tab-buttons-wrapper, .main-tab-buttons {{
            text-align: center;
            margin-top: 10px;
        }}
        .main-tab {{
            display: none;
            width: 100%;
        }}
    </style>
</head>
<body>
    <h1>Closure Code Dashboard</h1>

    <div class="main-tab-buttons">
        <button class="maintablink active" onclick="switchMainTab(event, 'globalTab')">Global Statistics</button>
        <button class="maintablink" onclick="switchMainTab(event, 'individualTab')">Individual Reports</button>
        <button class="maintablink" onclick="switchMainTab(event, 'schedulingTab')">Scheduling</button>
    </div>

    <!-- === GLOBAL TAB === -->
    <div id="globalTab" class="main-tab" style="display:block">
        <div class="tabcontent" style="display:block">
            <h2>Global Closure Code Statistics</h2>
            <hr>
            {fail_line_html}
            <hr>
            {closure_pie_html}
            <hr>
            {closed_line_html}
            <hr>
            <h3>Monthly Row Counts by Sheet</h3>
            {end_tab_chart_html}
        </div>
    </div>

    <!-- === INDIVIDUAL REPORTS TAB === -->
    <div id="individualTab" class="main-tab" style="display:none">
        <div class="tab-buttons-wrapper">
            {''.join(tab_buttons)}
        </div>
        {''.join(tab_contents)}
    </div>

    <!-- === SCHEDULING TAB === -->
    <div id="schedulingTab" class="main-tab" style="display:none">
        {scheduling_tab_html}
    </div>
</body>
</html>
"""

# === Write HTML to file ===
with open(EXPORT_HTML, 'w', encoding='utf-8') as f:
    f.write(html_output)

print(f"âœ… Dashboard created at: {EXPORT_HTML}")
