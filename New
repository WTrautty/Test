import win32com.client

# Launch Outlook namespace
outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

# === Choose mailbox ===
# Option 1: By name
mailbox_name = "Your Shared Mailbox Name Here"  # <-- Change this
mailbox = outlook.Folders.Item(mailbox_name)

# Option 2: By index (uncomment if you prefer)
# mailbox = outlook.Folders.Item(2)

# Confirm selection
print(f"Selected mailbox: {mailbox.Name}")

# Select the Inbox
inbox = mailbox.Folders.Item("Inbox")
print(f"Selected folder: {inbox.Name}")

# Get messages
messages = inbox.Items
messages.Sort("[ReceivedTime]", True)

print("\nScanning emails...\n")

count = 0
index = 0

for message in messages:
    index += 1
    try:
        subject = message.Subject or ""
        sender = message.SenderEmailAddress or ""
        received_time = str(message.ReceivedTime)

        print(f"\n=== Email #{index} ===")
        print(f"Sender: {sender}")
        print(f"Subject: {subject}")
        print(f"Received: {received_time}")

        sender_match = sender.lower() == "johndoe@aol.com"
        subject_match = "designated" in subject.lower()

        print(f"Sender match: {sender_match}")
        print(f"Subject match: {subject_match}")

        if sender_match and subject_match:
            print(">>>>> MATCH FOUND <<<<<")
            print("----- Email -----")
            print("From:", sender)
            print("Date:", received_time)
            print("Subject:", subject)
            print()
            count += 1

    except Exception as e:
        print(f"Skipping item due to error: {e}")
        continue

print(f"\nFinished scanning. Found {count} matching emails.")
