import pandas as pd

def reformat_sheet_to_vertical(sheet_df, audit_name):
    row = sheet_df.iloc[0]
    vertical_data = []

    for i in range(0, len(row), 3):
        try:
            criterion = str(row[i]).strip()
            weight = row[i+1]
            score_type = row[i+2]

            if pd.notna(criterion) and pd.notna(score_type):
                vertical_data.append({
                    "AuditName": audit_name,
                    "AuditDate": "",  # Leave blank for user to fill later
                    "Criterion": criterion,
                    "Weight": weight,
                    "ScoreType": score_type,
                    "Score": "",
                    "Notes": ""
                })
        except IndexError:
            continue

    return pd.DataFrame(vertical_data)

def reformat_workbook_vertically(input_path, output_path):
    xls = pd.ExcelFile(input_path)

    all_sheets_combined = []

    for sheet_name in xls.sheet_names:
        df = xls.parse(sheet_name)
        clean_df = reformat_sheet_to_vertical(df, sheet_name)
        all_sheets_combined.append(clean_df)

    final_df = pd.concat(all_sheets_combined, ignore_index=True)
    final_df.to_excel(output_path, index=False)
    print(f"Reformatted vertical workbook saved to: {output_path}")

# Example usage
if __name__ == "__main__":
    input_file = "audit_templates.xlsx"  # Replace with your file name
    output_file = "audit_templates_vertical.xlsx"
    reformat_workbook_vertically(input_file, output_file)
