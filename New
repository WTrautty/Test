import win32com.client

# Create Outlook application object
outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

# Default Inbox
inbox = outlook.GetDefaultFolder(6)

# Get all messages
messages = inbox.Items
# Sort descending by received time
messages.Sort("[ReceivedTime]", True)

print("Scanning emails...\n")

count = 0
for message in messages:
    try:
        subject = message.Subject or ""
        sender = message.SenderEmailAddress or ""
        if (
            sender.lower() == "johndoe@aol.com"
            and "designated" in subject.lower()
        ):
            print("----- Email -----")
            print("From:", sender)
            print("Date:", message.ReceivedTime)
            print("Subject:", subject)
            print()
            count += 1
    except Exception as e:
        # Skip non-mail items
        continue

print(f"Found {count} matching emails.")
