def generate_lec_tab(df):
    if "Revised LEC" not in df.columns:
        return "<div id='lecTab' class='main-tab'><h2>'Revised LEC' column not found in data.</h2></div>"

    df = df.copy()
    df["Is Fail"] = df["Closure Code 1"].str.lower().str.contains("fail|failed|failure", na=False)

    # Pie chart: all LEC appearances
    lec_counts = df["Revised LEC"].value_counts(dropna=False).reset_index()
    lec_counts.columns = ["LEC", "Count"]
    lec_total_pie = px.pie(lec_counts, names="LEC", values="Count", title="All Revised LEC Appearances")
    lec_total_pie.update_layout(height=300)
    lec_total_html = lec_total_pie.to_html(full_html=False, include_plotlyjs=True)

    # Pie chart: only LECs associated with failures
    fail_df = df[df["Is Fail"] == True]
    lec_fail_counts = fail_df["Revised LEC"].value_counts(dropna=False).reset_index()
    lec_fail_counts.columns = ["LEC", "Count"]
    lec_fail_pie = px.pie(lec_fail_counts, names="LEC", values="Count", title="Revised LEC Appearances on Failures")
    lec_fail_pie.update_layout(height=300)
    lec_fail_html = lec_fail_pie.to_html(full_html=False, include_plotlyjs=False)

    return f"""
    <div id="lecTab" class="main-tab">
      <h2>LEC Insights</h2>
      <hr>{lec_total_html}
      <hr>{lec_fail_html}
    </div>
    """
