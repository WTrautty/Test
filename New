def generate_Barry_mac_pie_tab():
    from datetime import datetime
    import pandas as pd
    import plotly.graph_objects as go

    try:
        df = pd.read_excel(EXCEL_PATH, sheet_name="Sheet2", engine="openpyxl")
    except Exception as e:
        return f"<p><strong>Failed to load Sheet2:</strong> {e}</p>"

    required_cols = ["Task Owner", "Task Name", "Completed Date"]
    if not all(col in df.columns for col in required_cols):
        return "<p><strong>Missing required columns in Sheet2.</strong></p>"

    df["Completed Date"] = pd.to_datetime(df["Completed Date"], errors="coerce")
    filtered_df = df[
        (df["Task Name"].str.upper() == "MACD") &
        (df["Completed Date"] >= datetime(2024, 10, 10))
    ]

    task_owner_counts = filtered_df["Task Owner"].dropna().value_counts()
    if task_owner_counts.empty:
        return "<p><strong>No matching MACD data since 10/10/2024.</strong></p>"

    fig = go.Figure(data=[
        go.Pie(labels=task_owner_counts.index, values=task_owner_counts.values, hole=0.4)
    ])
    fig.update_layout(title="MACD Task Owner Distribution (since 10/10/2024)")

    return fig.to_html(full_html=False, include_plotlyjs=False)



elif customer_id == "Barry":
    general_html = f"""
    <div id="BarryTab-general" class="main-tab" style="display:block;">
      <h2>Task Ownership Distribution</h2>
      {generate_Barry_task_owner_pie()}
    </div>
    """

    mac_chart_html = generate_Barry_mac_pie_tab()  # returns just the chart or error message
    mac_html = f"""
    <div id="BarryTab-mac" class="main-tab" style="display:none;">
      <h2>IPv6 MACD Completions</h2>
      {mac_chart_html}
    </div>
    """

    return f"""
    <div class="customer-container" id="customer-{customer_id}" style="display:none;">
      <div class="sidebar">
        <h2>Barry</h2>
        <button onclick="switchMainTab(event, 'BarryTab-general')">General</button>
        <button onclick="switchMainTab(event, 'BarryTab-mac')">MAC</button>
      </div>
      <div class="main-content">
        <h1>Barry Data</h1>
        {general_html}
        {mac_html}
      </div>
    </div>
    """
