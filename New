import win32com.client

# Create Outlook application object
outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

# 0 = Default Inbox
inbox = outlook.GetDefaultFolder(6)

# You can use this if you want a subfolder:
# inbox = outlook.Folders.Item("Mailbox Name").Folders.Item("Inbox")

# Get all messages
messages = inbox.Items

# Restrict to only items with the word "designated" in the Subject
# NOTE: Restrict uses SQL-like syntax and is case-insensitive
filtered_messages = messages.Restrict("[Subject] Like '%designated%'")

# Sort by received time descending
filtered_messages.Sort("[ReceivedTime]", True)

print("Scanning emails...\n")

count = 0
for message in filtered_messages:
    try:
        # Filter by sender email address
        if message.SenderEmailAddress.lower() == "johndoe@aol.com":
            print("----- Email -----")
            print("From:", message.SenderEmailAddress)
            print("Date:", message.ReceivedTime)
            print("Subject:", message.Subject)
            print()
            count += 1
    except Exception as e:
        # Sometimes non-mail items cause issues
        print(f"Skipping item: {e}")

print(f"Found {count} matching emails.")
