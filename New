from office365.sharepoint.client_context import ClientContext
from office365.runtime.auth.authentication_context import AuthenticationContext

# === Configuration ===
site_url = "https://yourcompany.sharepoint.com/sites/yoursite"
username = "you@yourcompany.com"
password = "yourpassword"  # Prefer app password if MFA is enabled

# === Test Authentication and List Files in Documents Library ===
try:
    ctx_auth = AuthenticationContext(site_url)
    if ctx_auth.acquire_token_for_user(username, password):
        ctx = ClientContext(site_url, ctx_auth)
        web = ctx.web
        ctx.load(web)
        ctx.execute_query()
        print(f"Connected to site: {web.properties['Title']}")

        # Test access to a Document Library
        library_name = "Documents"
        target_library = ctx.web.lists.get_by_title(library_name)
        items = target_library.items.top(5).get().execute_query()

        print(f"Found {len(items)} items in '{library_name}':")
        for item in items:
            print(f"- {item.properties.get('FileLeafRef', '[No Name]')}")
    else:
        print("Failed to acquire token. Check credentials or MFA.")
except Exception as e:
    print("Error:", e)
