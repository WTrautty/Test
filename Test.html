import re

template = template.replace('{Ops Console Ticket}', order_number.strip())
template = template.replace('{Region}', (ipv6_region if ipv6_region else "").strip())
template = template.replace('{Lan (Data 1)}', (fixed_lan if fixed_lan else "").strip())
template = template.replace('{WAN/126 CE}', (ce_wan if ce_wan else "").strip())
template = template.replace('{WAN/126 CEnoSub}', (ce_wan.split('/')[0] if ce_wan else "").strip())
template = template.replace('{md_pw}', md_pw.strip())
template = template.replace('{j_bar}', (j_bar if j_bar else "").strip())
template = template.replace('{jRI}', jRI.strip())
template = template.replace('{vprn}', vprn.strip())
template = template.replace('{area}', area.strip())
template = template.replace('{IPv6_wan_noSub}', (data.get("IPv6 WAN", "").split('/')[0]).strip())
template = template.replace('{IPv6_lan_noSub}', data.get("IPv6 LAN", "").split('/')[0].strip())
template = template.replace('{IPv6_lan_noSuband1}', data.get("IPv6 LAN", "").split('/')[0].strip() + "1")
template = template.replace('{IPv6_lan_Sub64and1}', data.get("IPv6 LAN", "").split('/')[0].strip() + "1/64")
template = template.replace('{IPv6_lan_and1}', data.get("IPv6 LAN", "").split('/')[0].strip() + "1")
template = template.replace('{WAN_CE}', data.get("IPv6 WAN", "").split('/')[0].strip())
template = template.replace('{Node_Only}', data.get("Node Name", "").split('.')[0].strip())
template = template.replace('{regional_vlan}', "80" + (ipv6_region if ipv6_region else "").strip())
template = template.replace('{IPv6 Status}', data.get("IPv6 Status", "").strip())
if data.get("IPv6 Loopback", ""):
    loopback_parts = data.get("IPv6 Loopback", "").split('/')
    if len(loopback_parts) > 1:
        template = template.replace('{IPv6 Loopback_andone}', loopback_parts[0].strip() + "/" + loopback_parts[1].strip())
template = template.replace('{Service ID}', data.get("Service ID", "").strip())
template = template.replace('{IPv6 WAN}', data.get("IPv6 WAN", "").strip())
template = template.replace('{IPv6 LAN}', data.get("IPv6 LAN", "").strip())
template = template.replace('{IPv6 Loopback}', data.get("IPv6 Loopback", "").strip())
template = template.replace('{DOI_Bureau}', data.get("DOI_Bureau", "").strip())
template = template.replace('{WHD_Location}', data.get("WHD_Location", "").strip())
template = template.replace('{Node Name}', data.get("Node Name", "").strip())
template = template.replace('{IP Address}', data.get("IP Address", "").strip())
template = template.replace('{Address}', data.get("Address", "").strip())
template = template.replace('{City}', data.get("City", "").strip())
template = template.replace('{State}', data.get("State", "").strip())
template = template.replace('{Vendor}', data.get("Vendor", "").strip())
template = template.replace('{pe_type}', pe_type.strip())
template = template.replace(
    '{WHD_Location_City}',
    (lambda m: (m.group(1).replace('_', ' ') if m else "").strip())(
        re.search(r'-(?P<group>[^-]*)-(?!.*-)', data.get("WHD_Location", " "))
    )
)

# Replace new placeholders from LASER results
template = template.replace('{default_interface}', default_interface.strip())
template = template.replace('{default_device}', default_device.strip())
template = template.replace('{default_scid}', default_scid.strip())
template = template.replace('{default_location}', default_location.strip())
template = template.replace('{default_wan_ip}', default_wan_ip.strip())
if default_wan_ip:
    wan_parts = default_wan_ip.split('/')[0].split('.')
    wan_parts[-1] = str(int(wan_parts[-1]) + 1)
    template = template.replace('{default_wan_ipand1}', '.'.join(wan_parts).strip())
else:
    template = template.replace('{default_wan_ipand1}', "")
template = template.replace('{default_vrf}', default_vrf.strip())
if default_interface:
    template = template.replace('{def_int_noSub}', default_interface.split('.')[0].strip())
else:
    template = template.replace('{def_int_noSub}', "")
template = template.replace('{t1_int}', default_interface.split('.')[0].replace(':', '.').strip())
