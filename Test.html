import pandas as pd
import matplotlib.pyplot as plt

# Load Excel
file_path = r"C:\Users\AD39644\On\lsx"
df = pd.read_excel(file_path, sheet_name='Sheet2', engine='openpyxl')

# Get LEC failure data (column 12) and usage data (column 2)
failures = df.iloc[:, 12].value_counts()
usages = df.iloc[:, 2].value_counts()

# Align LECs between both sets (some may only appear in one)
all_lecs = set(failures.index).union(set(usages.index))
failure_rate = {}

for lec in all_lecs:
    fail_count = failures.get(lec, 0)
    use_count = usages.get(lec, 0)
    if use_count > 0:
        failure_rate[lec] = (fail_count / use_count) * 100
    else:
        failure_rate[lec] = 0  # Avoid divide-by-zero

# Convert to DataFrame for plotting
rate_df = pd.Series(failure_rate).sort_values(ascending=False)

# Optional: filter out LECs with very low usage if needed
# rate_df = rate_df[usages[rate_df.index] > 10]

# Plot horizontal bar chart
plt.figure(figsize=(12, 8))
rate_df.plot(kind='barh', color='#E15759')
plt.xlabel("Failure Rate (%)")
plt.title("LEC Failure Rate by Usage")
plt.gca().invert_yaxis()  # Highest failure rate on top
plt.grid(axis='x', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()
