import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.cm as cm
from scipy.stats import pearsonr

# Load the Excel file
file_path = r"C:\U"  # <-- change this to your file
df = pd.read_excel(file_path, sheet_name='Sheet2', engine='openpyxl')

# === Extract Column L (LEC Name) ===
lec_names = df.iloc[:, 0]
lec_counts = lec_names.value_counts()

# === Extract failure and usage counts ===
failure_counts = df.iloc[:, 1]  # Assuming failures are in Column 1
usage_counts = df.iloc[:, 2]    # Assuming total usages are in Column 2

# === Aggregate by LEC Name ===
lec_data = df.groupby(lec_names).sum()

# === Compute Failure Rates ===
lec_data["Failure Rate"] = lec_data.iloc[:, 0] / lec_data.iloc[:, 1]  # Failures / Usages

# === Compute Correlation ===
corr, p_value = pearsonr(lec_data.iloc[:, 1], lec_data["Failure Rate"])  # Usage count vs. Failure rate

print(f"Pearson correlation coefficient: {corr:.4f}")
print(f"P-value: {p_value:.4f}")

# === Visualization ===
plt.figure(figsize=(10, 5))
plt.scatter(lec_data.iloc[:, 1], lec_data["Failure Rate"], c="blue", alpha=0.5)
plt.xlabel("LEC Selection Count (Usage)")
plt.ylabel("Failure Rate")
plt.title("Correlation between LEC Selection and Failure Rate")
plt.grid(True)
plt.show()

    
