import pandas as pd
import matplotlib.pyplot as plt
from scipy.stats import pearsonr

# Load the Excel file
file_path = r"C:\U"  # <-- change this to your file
df = pd.read_excel(file_path, sheet_name='Sheet2', engine='openpyxl')

# === Extract LEC lists ===
failures = df.iloc[:, 0]  # Index 0: LECs that failed
usages = df.iloc[:, 2]    # Index 2: All LEC selections

# === Count occurrences ===
failure_counts = failures.value_counts()
usage_counts = usages.value_counts()

# === Align data & calculate failure rates ===
lec_data = pd.DataFrame({'Usages': usage_counts, 'Failures': failure_counts}).fillna(0)
lec_data['Failure Rate'] = lec_data['Failures'] / lec_data['Usages']

# === Compute Pearson Correlation ===
corr, _ = pearsonr(lec_data['Usages'], lec_data['Failure Rate'])

# === Visualization ===
fig, ax = plt.subplots(1, 2, figsize=(12, 5))

# Pie Chart: LEC Selection Distribution
lec_data['Usages'].plot(kind='pie', ax=ax[0], autopct='%1.1f%%', title="LEC Selection Distribution")

# Scatter Plot: Failure Rate vs. Usage
ax[1].scatter(lec_data['Usages'], lec_data['Failure Rate'], alpha=0.7)
ax[1].set_title(f"Failure Rate vs. LEC Usage\n(Pearson r={corr:.2f})")
ax[1].set_xlabel("Number of Usages")
ax[1].set_ylabel("Failure Rate")

plt.tight_layout()
plt.show()
