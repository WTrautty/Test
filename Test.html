
import os
import re
import shutil
import glob

def process_file(filepath, new_dir):
    with open(filepath, 'r') as file:
        content = file.read()
    # Remove the specific error message.
    content = content.replace(r'stty: standard input: Inappropriate ioctl for device', '\n')
    content = content.replace(r'Exit Status: 0', '\n')
    packets_received = ["1 packets received", "2 packets received", "3 packets received", "4 packets received", "5 packets received"] 


    filename = os.path.basename(filepath)

    # Use a regex to extract text between the delimiters.
    pattern = re.compile(r'AUTOMATED COMMANDS OUTPUT:(.*?)END OF AUTOMATED OUTPUT', re.DOTALL)
    match = pattern.search(content)
    
    # If the delimiters are not found, move file to "Scripting Error" folder
    if not match:
        target_folder = os.path.join(new_dir, "Scripting Error")
        new_filename = "Script Error " + filename
        os.makedirs(target_folder, exist_ok=True)
        target_path = os.path.join(target_folder, new_filename)
        shutil.move(filepath, target_path)
        print(f"Moved {filename} to {target_folder} as {new_filename}")
        return

    # Extract the section between delimiters.
    section = match.group(1)
    
    # Check for conditions and set target folder and filename accordingly.
    if any(section.count(packet) == 0 for packet in packets_received):
        target_folder = os.path.join(new_dir, "Unpingable")
        new_filename = "Unpingable " + filename
    elif section.count("::/0") < 3:
        # Now further subdivide within the "Routes Found" folder.
        # Check if exactly two "[1-5] packets received" occur.
        if any(section.count(packet) == 2 for packet in packets_received):
            target_folder = os.path.join(new_dir, "Routes Found", "IPv6 Pingable")
            new_filename = "Routes - IPv6 Pinged - " + filename
        else:
            target_folder = os.path.join(new_dir, "Routes Found", "IPv6 Not Reachable")
            new_filename = "Routes - IPv6 Unreached - " + filename
    elif any(section.count(packet) == 1 for packet in packets_received):
        print(f"No conditions met for {filename}")
        target_folder = os.path.join(new_dir, "Clean")
        new_filename = filename  # Keep the original name.
    else:
        print(f"More or Less than one pingable {filename}")
        target_folder = os.path.join(new_dir, "Ping Check")
        new_filename = "Ping Check - " + filename

    os.makedirs(target_folder, exist_ok=True)
    target_path = os.path.join(target_folder, new_filename)
    shutil.move(filepath, target_path)
    print(f"Moved {filename} to {target_folder} as {new_filename}")

def main():
    # Specify the original directory containing the .txt files.
    directory = r"C:\Users\AD39644\IPv6_Test_Files\2025-03-05"
    # Specify the new directory where files will be moved.
    new_dir = r"C:\Users\AD39644\OneDrive - Lumen\Python Version"
    # Find all .txt files in the specified original directory.
    txt_files = glob.glob(os.path.join(directory, "*.txt"))
    for filepath in txt_files:
        process_file(filepath, new_dir)

if __name__ == '__main__':
    main()
