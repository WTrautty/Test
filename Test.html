import os
import re

# Set these paths to match your directories
source_folder = "path/to/source_folder"
reference_folder = "path/to/reference_folder"

# Regex pattern to extract the value after "Node Name" up to the next "."
node_pattern = re.compile(r"Node Name\s*:\s*(\S+?)\.", re.IGNORECASE)

for filename in os.listdir(source_folder):
    if filename.endswith(".txt"):
        file_path = os.path.join(source_folder, filename)

        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # Search for the node name
        match = node_pattern.search(content)
        if not match:
            print(f"No Node Name found in {filename}")
            continue

        node_name = match.group(1)
        print(f"Found Node: {node_name} in {filename}")

        # Find matching file in reference folder
        matching_file = next(
            (f for f in os.listdir(reference_folder) if f.startswith(node_name) and f.endswith('.txt')),
            None
        )

        if not matching_file:
            print(f"No reference file starting with '{node_name}' found.")
            continue

        reference_path = os.path.join(reference_folder, matching_file)
        with open(reference_path, 'r', encoding='utf-8') as ref_file:
            ref_content = ref_file.read()

        # Replace {Fort Configs} with the content of the matching file
        if '{Fort Configs}' in content:
            new_content = content.replace('{Fort Configs}', ref_content)

            # Write the updated content back to the same file
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(new_content)
            print(f"Updated {filename} with Fort Configs from {matching_file}")
        else:
            print(f"Placeholder {{Fort Configs}} not found in {filename}")
