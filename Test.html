import os
import re

# === CONFIGURATION ===
input_folder = r"C:\Path\To\Your\TextFiles"  # <- Update this to your folder

# === HELPER FUNCTION ===
def fix_prefix_after_marker(lines, marker, indentation):
    found_marker = False
    for i, line in enumerate(lines):
        if marker in line:
            found_marker = True
        elif found_marker and "set prefix6" in line:
            match = re.search(r"(set prefix6\s+\S+)", line)
            if match:
                parts = line.strip().split()
                if parts[-1] and not parts[-1].endswith("/56"):
                    parts[-1] = re.sub(r"/\d{1,3}$", "/56", parts[-1])
                lines[i] = f"{indentation}{' '.join(parts)}\n"
            break
    return lines

# === MAIN SCRIPT ===
for root, _, files in os.walk(input_folder):
    for file in files:
        if file.lower().endswith(".txt"):
            file_path = os.path.join(root, file)
            with open(file_path, "r", encoding="utf-8", errors="ignore") as f:
                lines = f.readlines()

            # Fix with correct indentation
            lines = fix_prefix_after_marker(lines, "CONFIGURE PREFIX-LISTS", indentation="\t\t")
            lines = fix_prefix_after_marker(lines, "CONFIGURE BGP", indentation="\t")

            # Write changes back to file
            with open(file_path, "w", encoding="utf-8") as f:
                f.writelines(lines)
