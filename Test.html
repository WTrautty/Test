import os
import re
import shutil
import glob

def process_file(filepath):
    with open(filepath, 'r') as file:
        content = file.read()

    # Use a regex to extract text between the delimiters.
    pattern = re.compile(r'AUTOMATED COMMANDS OUTPUT:(.*?)END OF AUTOMATED OUTPUT', re.DOTALL)
    match = pattern.search(content)
    if not match:
        print(f"Delimiters not found in {filepath}")
        return

    section = match.group(1)
    base_dir = os.path.dirname(filepath)
    filename = os.path.basename(filepath)

    # Check for conditions and create target folder and new filename accordingly.
    if "0 packets received" in section:
        target_folder = os.path.join(base_dir, "unreachable")
        new_filename = "Unpingable " + filename
    elif section.count("(tunneled)") < 3 or section.count("::/0") < 3:
        target_folder = os.path.join(base_dir, "Routes Found")
        new_filename = "Routes Found " + filename
    else:
        print(f"No conditions met for {filename}")
        target_folder = os.path.join(base_dir, "Clean")
        new_filename = filename  # Keep the original name, or modify if desired

    # Create the target folder if it doesn't exist.
    os.makedirs(target_folder, exist_ok=True)
    
    # Construct the new file path.
    target_path = os.path.join(target_folder, new_filename)
    
    # Move (and rename) the file.
    shutil.move(filepath, target_path)
    print(f"Moved {filename} to {target_folder} as {new_filename}")

def main():
    # Specify the directory you want to search.
    directory = r"C:\Users\AD39644\IPv6_Test_Files\2025-03-04"
    # Find all .txt files in the specified directory.
    txt_files = glob.glob(os.path.join(directory, "*.txt"))
    for filepath in txt_files:
        process_file(filepath)

if __name__ == '__main__':
    main()
