import os
import re

# Set your actual folder paths here
source_folder = "path/to/source_folder"
reference_folder = "path/to/reference_folder"

# Regex to extract the Node Name value before the first "."
node_pattern = re.compile(r"Node Name\s*:\s*(\S+?)\.", re.IGNORECASE)

for filename in os.listdir(source_folder):
    if filename.endswith(".txt"):
        file_path = os.path.join(source_folder, filename)

        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()

        # Extract node name
        match = node_pattern.search(content)
        if not match:
            print(f"No Node Name found in {filename}")
            continue

        node_name = match.group(1)
        print(f"Found Node: {node_name} in {filename}")

        # Find the matching reference file
        matching_file = next(
            (f for f in os.listdir(reference_folder) if f.startswith(node_name) and f.endswith('.txt')),
            None
        )

        if not matching_file:
            print(f"No reference file starting with '{node_name}' found.")
            continue

        reference_path = os.path.join(reference_folder, matching_file)
        with open(reference_path, 'r', encoding='utf-8') as ref_file:
            ref_content = ref_file.read()

        # Perform replacements
        new_content = content
        if '{Fort Configs}' in new_content:
            new_content = new_content.replace('{Fort Configs}', ref_content)
        else:
            print(f"Placeholder {{Fort Configs}} not found in {filename}")

        if '{filename found}' in new_content:
            new_content = new_content.replace('{filename found}', matching_file)
        else:
            print(f"Placeholder {{fort config file found}} not found in {filename}")

        # Save the updated content
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
        print(f"Updated {filename} with content from {matching_file}")
