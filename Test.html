from collections import defaultdict

# === Prepare data structure for visual layout ===
schedule_map = defaultdict(lambda: defaultdict(str))

# Fill the map with appointment slots
time_step = timedelta(minutes=30)  # adjust as needed
for i, appt in enumerate(appointments):
    tech = best[i]
    start = appt["start"]
    end = appt["end"]
    subject = appt["subject"]

    current_time = start
    while current_time < end:
        key = current_time.strftime("%H:%M")
        schedule_map[key][tech] = subject
        current_time += time_step

# Create new sheet
if "Schedule View" in wb.sheetnames:
    del wb["Schedule View"]
ws_sched = wb.create_sheet("Schedule View")

# Write headers
tech_names = [t["name"] for t in technicians]
ws_sched.append(["Time"] + tech_names)

# Sort time slots and fill rows
for time_slot in sorted(schedule_map.keys()):
    row = [time_slot]
    for tech in tech_names:
        row.append(schedule_map[time_slot].get(tech, ""))
    ws_sched.append(row)
