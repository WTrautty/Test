
import os
import glob
import pandas as pd

# Set the folder containing your CSV files.
folder_path = r'C:\Users\AD39644\OneDrive - Lumen\Documents - USDA Site and SDWAN Device Details\CSVs'

# List to hold details of CSV files that fail the condition.
failed_files = []

# Recursively get a list of all CSV files.
csv_files = glob.glob(os.path.join(folder_path, '**', '*.csv'), recursive=True)
print(f"Found {len(csv_files)} CSV files.")

# Filter to only files with "xyzxyz" in the filename (case-insensitive).
target_csv_files = [f for f in csv_files if "xyzxyz" in os.path.basename(f).lower()]
print(f"Processing {len(target_csv_files)} CSV files with 'xyzxyz' in the name.")

for file_path in target_csv_files:
    try:
        # Read CSV using header=None since orientation may vary.
        try:
            df = pd.read_csv(file_path, encoding='utf-8', header=None)
        except UnicodeDecodeError:
            df = pd.read_csv(file_path, encoding='latin1', header=None)
    except Exception as e:
        print(f"Error reading {file_path}: {e}")
        failed_files.append(f"Read Error: {os.path.basename(file_path)}\n{file_path}\n")
        continue

    # Determine orientation by examining the first 4 rows and 4 columns.
    vertical_condition = False
    horizontal_condition = False

    # Check if the file has at least 4 rows.
    if df.shape[0] >= 4:
        row4 = df.iloc[3]  # 4th row (0-indexed)
        # If any cell in the 4th row is non-empty, mark vertical.
        if row4.astype(str).str.strip().apply(len).max() > 0:
            vertical_condition = True

    # Check if the file has at least 4 columns.
    if df.shape[1] >= 4:
        col4 = df.iloc[:, 3]  # 4th column (0-indexed)
        # If any cell in the 4th column is non-empty, mark horizontal.
        if col4.astype(str).str.strip().apply(len).max() > 0:
            horizontal_condition = True

    # Decide orientation. If both or neither, default to vertical.
    if vertical_condition and not horizontal_condition:
        orientation = "vertical"
    elif horizontal_condition and not vertical_condition:
        orientation = "horizontal"
    elif vertical_condition and horizontal_condition:
        print(f"File {os.path.basename(file_path)}: Both row 4 and column 4 have values; defaulting to vertical.")
        orientation = "vertical"
    else:
        print(f"File {os.path.basename(file_path)}: Neither row 4 nor column 4 has values; defaulting to vertical.")
        orientation = "vertical"

    candidate = None
    details = ""
    file_failed = False

    if orientation == "vertical":
        # Assume keys are in the first column.
        for i in range(df.shape[0]):
            cell_value = str(df.iloc[i, 0]).strip()
            if cell_value.lower().endswith("sister"):
                print(f"File {os.path.basename(file_path)}: Found sister indicator at row {i}, column 0: '{cell_value}'")
                # Candidate value is in the next column (same row).
                col_idx = 1
                candidate = ""
                while col_idx < df.shape[1] and candidate == "":
                    candidate = str(df.iloc[i, col_idx]).strip()
                    if candidate == "":
                        col_idx += 1
                print(f"File {os.path.basename(file_path)}: Associated candidate value from row {i}, column {col_idx}: '{candidate}'")
                break
    else:  # horizontal orientation
        # Assume keys are in the first row.
        for j in range(df.shape[1]):
            cell_value = str(df.iloc[0, j]).strip()
            if cell_value.lower().endswith("sister"):
                print(f"File {os.path.basename(file_path)}: Found sister indicator at row 0, column {j}: '{cell_value}'")
                # Candidate value is in the next row (same column).
                row_idx = 1
                candidate = ""
                while row_idx < df.shape[0] and candidate == "":
                    candidate = str(df.iloc[row_idx, j]).strip()
                    if candidate == "":
                        row_idx += 1
                print(f"File {os.path.basename(file_path)}: Associated candidate value from row {row_idx}, column {j}: '{candidate}'")
                break

    if candidate is None or candidate == "":
        print(f"File {os.path.basename(file_path)}: No candidate value found after sister indicator.")
        continue

    # Check if the candidate value has at least 4 characters and its 4th character is "1".
    if len(candidate) < 4:
        details += f"Candidate value '{candidate}' is too short to check 4th digit.\n"
        file_failed = True
    else:
        if candidate[3] != "1":
            details += f"Candidate value '{candidate}' (4th character is '{candidate[3]}', expected '1').\n"
            file_failed = True

    if file_failed:
        failed_files.append(f"{os.path.basename(file_path)}\n{file_path}\n{details}\n")

# Write the details of CSV files that failed the condition to an output text file.
output_file = r'C:\Users\AD39644\Desktop\output.txt'
with open(output_file, "w") as f:
    for entry in failed_files:
        f.write(entry + "\n")

print(f"Script completed. {len(failed_files)} file(s) did not meet the condition. See '{output_file}' for details.")

      
