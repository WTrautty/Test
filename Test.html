import os
import glob
import pandas as pd

# Set the folder containing your CSV files
folder_path = r'C:\Users\AD39644\OneDrive - Lumen\Documents - USDA Site and SDWAN Device Details\CSVs'

# List to hold names of CSV files that fail the condition
failed_files = []

# Get list of all CSV files in the folder
csv_files = glob.glob(os.path.join(folder_path, "*.csv"))
print(f"Found {len(csv_files)} CSV files.")

for file_path in csv_files:
    print(f"\nProcessing file: {file_path}")
    try:
        # Read CSV (if your CSVs have no header, you might need header=None)
        df = pd.read_csv(file_path)
    except Exception as e:
        print(f"Could not read {file_path}: {e}")
        failed_files.append(os.path.basename(file_path))
        continue

    # Check if there are at least 2 columns (assuming first is key, second is value)
    if len(df.columns) < 2:
        print(f"File {file_path} does not have at least 2 columns.")
        failed_files.append(os.path.basename(file_path))
        continue

    key_col = df.columns[0]
    value_col = df.columns[1]
    file_failed = False

    # Optionally print a few sample keys for debugging
    print(f"Sample keys from '{key_col}':")
    print(df[key_col].head())

    # Iterate through each row in the CSV
    for idx, row in df.iterrows():
        key = str(row[key_col]).strip()
        # Process rows that match the pattern
        if key.startswith("/1/vpn_lan_subif") and key.endswith("_name/interface/shutdown"):
            # Skip the exception key
            if key == "/1/vpn_lan_subif200_name/interface/shutdown":
                continue
            # Check if the corresponding value is "TRUE" (case insensitive)
            value = str(row[value_col]).strip().upper()
            if value != "TRUE":
                print(f"File {os.path.basename(file_path)}: Row {idx} with key '{key}' has value '{value}'")
                file_failed = True
                break

    if file_failed:
        failed_files.append(os.path.basename(file_path))
    else:
        print(f"File {os.path.basename(file_path)} passed the check.")

# Write the names of CSV files that failed the condition to a text file
output_path = r"C:\Users\AD39644\Documents\output.txt"
with open(output_path, "w") as f:
    for name in failed_files:
        f.write(name + "\n")

print(f"\nScript completed. {len(failed_files)} file(s) did not meet the condition. See '{output_path}' for details.")
