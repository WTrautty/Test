import re

# === Set your file paths here ===
input_file_path = r"C:\Path\To\Your\Input.txt"
output_file_path = r"C:\Path\To\Your\Output_Mismatches.txt"

# === Read and split the input file ===
with open(input_file_path, 'r', encoding='utf-8', errors='ignore') as file:
    content = file.read()

chunks = content.split("routing-instance")

# === Define mismatch storage ===
mismatched_chunks = []

# === Process each chunk ===
for index, chunk in enumerate(chunks[1:], start=1):  # Skip the part before the first 'routing-instance'
    full_chunk = "routing-instance" + chunk  # Add back the delimiter for context
    reasons = []

    # Check for Service-Engine0/1/0
    if "Service-Engine0/1/0" in full_chunk:
        if not re.search(r"NIM subslot 0/1.*NIM Voice Analog Module", full_chunk):
            reasons.append("Missing Voice Analog Module for Service-Engine0/1/0")

    # Check for Service-Engine0/2/0
    if "Service-Engine0/2/0" in full_chunk:
        if not re.search(r"NIM subslot 0/2.*Voice Analog Module", full_chunk):
            reasons.append("Missing Voice Analog Module for Service-Engine0/2/0")

    # Check for interface GigabitEthernet0/1/
    if "interface GigabitEthernet0/1/" in full_chunk:
        if not re.search(r'NIM subslot 0/1.*DESCR:\s*"NIM-ES2"', full_chunk):
            reasons.append('Missing DESCR: "NIM-ES2" for GigabitEthernet0/1/')

    # Check for interface GigabitEthernet0/2/
    if "interface GigabitEthernet0/2/" in full_chunk:
        if not re.search(r'NIM subslot 0/2.*DESCR:\s*"NIM-ES2"', full_chunk):
            reasons.append('Missing DESCR: "NIM-ES2" for GigabitEthernet0/2/')

    # Save full chunk if any reason failed
    if reasons:
        mismatched_chunks.append("==== MISMATCH FOUND ====")
        mismatched_chunks.extend([f"Reason: {r}" for r in reasons])
        mismatched_chunks.append(full_chunk.strip())
        mismatched_chunks.append("\n")  # Extra line between mismatches

# === Write to output file ===
with open(output_file_path, 'w', encoding='utf-8') as out_file:
    if mismatched_chunks:
        out_file.write("\n".join(mismatched_chunks))
        print(f"[!] Mismatches found. Details written to:\n{output_file_path}")
    else:
        out_file.write("No mismatches found.")
        print("[âœ“] No mismatches found.")
