import os
import re

# === USER INPUT ===
input_path = r"your\input\directory\here"
output_path = r"your\output\file\here.txt"
# ===================

nsc_tech_map = {}
all_nsc_codes = set()
pdf_files = []

# Walk through all files
for root, _, files in os.walk(input_path):
    for file in files:
        file_path = os.path.join(root, file)

        # Collect all PDFs
        if file.lower().endswith(".pdf"):
            pdf_files.append(file)

        # Process TXT files
        elif file.lower().endswith(".txt"):
            with open(file_path, "r", encoding="utf-8", errors="ignore") as f:
                lines = f.readlines()
                tech = None
                nsc = None

                for line in lines:
                    line = line.strip()

                    if line.startswith("Activation Technician:"):
                        tech_match = re.search(r"Activation Technician:\s*(.*)", line)
                        if tech_match:
                            tech = tech_match.group(1).strip()

                    if line.startswith("NSC Code:"):
                        nsc_match = re.search(r"NSC Code:\s*(\S+)", line)
                        if nsc_match:
                            nsc = nsc_match.group(1).strip()
                            all_nsc_codes.add(nsc)

                if nsc:
                    nsc_tech_map[nsc] = tech or "Unknown"

# Find missing NSC PDFs
missing_nscs = [
    nsc for nsc in all_nsc_codes
    if not any(nsc in pdf for pdf in pdf_files)
]

# Write missing NSC info to file
with open(output_path, "w", encoding="utf-8") as out_file:
    for nsc in sorted(missing_nscs):
        out_file.write(f"NSC Code: {nsc} | Activation Technician: {nsc_tech_map.get(nsc, 'Unknown')}\n")

print(f"âœ… Export complete! Missing NSC PDFs written to:\n{output_path}")
