for root, dirs, files in os.walk(search_directory):
    for file in files:
        if file.lower().endswith('.csv'):
            csv_file_path = os.path.join(root, file)
            print(f"\nProcessing file: {csv_file_path}")
            
            # Read the CSV with encoding fallback
            data = read_csv_with_fallback(csv_file_path)
            print(f"File {file} loaded. Total rows: {len(data)}")
            if data:
                print(f"First row: {data[0]}")
            
            # Check if the CSV has at least 5 rows; inspect the 5th row, first column (A5 equivalent)
            transposed = False
            # Check if the CSV has at least 5 rows; inspect the 5th row, first column (A5 equivalent)				  
            if len(data) >= 5:
                a5_value = data[4][0] if len(data[4]) > 0 else ""
                print(f"A5 value: '{a5_value}'")
                if a5_value.strip() != '':															 
                    data = transpose_data(data)				 
                    print("CSV transposed based on A5 value.")
                else:
                    print("CSV not transposed (A5 is blank).")
            else:
                print("CSV has fewer than 5 rows; skipping A5 check.")
            # Now scan the (horizontal) data for the search pattern.
            for row_index, row in enumerate(data):
                for i in range(len(row) - 1):
                    cell = row[i].strip()
                    if "xyxz" in cell and "yzxy" in cell:
                        next_cell = row[i + 1].strip()  # The cell immediately after the matched cell
                        print(f"Found pattern in file {file} at row {row_index}, col {i}. Next cell: '{next_cell}'")
                        if len(next_cell) < 4:
                            print(f"Adjacent cell is blank for pattern {cell}. Recording result.")
                            results.append(f"{file}\t{csv_file_path}\t{cell}\t{next_cell}")
